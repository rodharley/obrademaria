<div class="container">
  <div class="py-5 text-center">
    <img class="d-block mx-auto mb-4" src="{URL_IMAGE_GRUPO}" alt="" height="140" class="shadow-sm">
    <h2>Checkout Obra de Maria DF</h2>
    <p class="lead">Você está adquirindo um pacote conosco, entre com seus dados e as informações</p>
  </div>
  <form class="needs-validation" novalidate="" action="checkoutEnd.php" method="POST">
  <div class="row">
    <div class="col-md-6 order-md-2 mb-4">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span >Seu Carrinho</span>
        
        <div class="btn-group" role="group" aria-label="Basic example">
          <button type="button" class="btn btn-danger" id="bt_menos">-</button>
          <button type="button" class="btn btn-secondary" id="lbl_quantidade">{QUANTIDADE}</button>
          <button type="button" class="btn btn-primary" id="bt_mais">+</button>
        </div>
        
      </h4>
      <ul class="list-group mb-3">
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0 text-muted" >{GRUPO_NOME}</h6>
            
          </div>
          <span class="text-muted">{GRUPO_VALOR_CURRENCY}</span>
        </li>
        <!-- BEGIN BLOCK_OPCIONAL -->
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          
          <div>
            <div class="custom-control custom-checkbox">
              <input type="checkbox" value="1" name="opcional" class="custom-control-input" id="opcional" >
              <label class="custom-control-label text-muted" for="opcional">{GRUPO_OPCIONAL_NOME}</label>
            </div>
            
            
          </div>
          <span class="text-muted">{GRUPO_OPCIONAL_VALOR_CURRENCY}</span>
        </li>
        <!-- END BLOCK_OPCIONAL -->        
        <li class="list-group-item d-flex justify-content-between">
          <span class="text-muted">Total ({GRUPO_MOEDA})</span>
          <strong class="text-muted" id="lbl_total">0,00</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span class="text-muted">Total R$</span>
          <strong class="text-muted" id="lbl_total_real">0,00</strong>
        </li>
      </ul>
      
      <hr class="mb-4">

      <h4 class="mb-3">Pagamento</h4>

      <div class="d-block my-3">
        <div class="custom-control custom-radio">
          <input value="1" id="credit" name="pagamento" type="radio" class="custom-control-input" checked="" required="">
          <label class="custom-control-label" for="credit">Cartão de crédito (GerenciaNet)</label>
        </div>
        <div class="custom-control custom-radio">
          <input value="2" id="debit" name="pagamento" type="radio" class="custom-control-input" required="">
          <label class="custom-control-label" for="debit">Boleto (GerenciaNet)</label>
        </div>
        <div class="custom-control custom-radio">
          <input value="3" id="paypal" name="pagamento" type="radio" class="custom-control-input" required="">
          <label class="custom-control-label" for="paypal">Paypal</label>
        </div>
      </div>
    </div>





    <div class="col-md-6 order-md-1">
      <h4 class="mb-3">Meus Dados</h4>
      
        <input type="hidden" name="quantidade" id="quantidade" value="{QUANTIDADE}"/>
        <input type="hidden" name="grupo" value="{ID_GRUPO}"/>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="cpf">CPF</label>
            <input type="text" class="form-control" id="cpf" placeholder="" value="" required="">
            <div class="invalid-feedback label-error feedback-cpf">
              Cpf requerido.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="nomecompleto">Nome Completo</label>
            <input type="text" class="form-control" id="nomecompleto" placeholder="" value="" required="">
            <div class="invalid-feedback label-error">
              Nome Completo Requerido.
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="email">E-mail</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text">@</span>
            </div>
            <input type="email" class="form-control" id="email" placeholder="email" required="">
            <div class="invalid-feedback label-error" style="width: 100%;">
              E-mail requirido.
            </div>
          </div>
        </div>
        <div id="boxAcompanhante">
        <h4 class="mb-3">Acompanhantes</h4>

        <div class="row" id="acomp1">          
          <div class="col-md-6 mb-3">
            <label for="nomecompleto">Nome Acompanhante 1</label>
            <input type="text" class="form-control" id="acompanhante1" placeholder="" value="" required="">
            <div class="invalid-feedback label-error">
              Nomes acompanhante 1 Requerido.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email">E-mail acompanhante 1</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">@</span>
              </div>
              <input type="email" class="form-control" id="email1" placeholder="email acompanhante 1" required="">
              <div class="invalid-feedback label-error" style="width: 100%;">
                E-mail acompanhante 1 requirido.
              </div>
            </div>
          </div>
        </div>


        <div class="row" id="acomp2">          
          <div class="col-md-6 mb-3">
            <label for="nomecompleto">Nome Acompanhante 2</label>
            <input type="text" class="form-control" id="acompanhante2" placeholder="" value="" required="">
            <div class="invalid-feedback label-error">
              Nomes acompanhante 2 Requerido.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email">E-mail acompanhante 2</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">@</span>
              </div>
              <input type="email" class="form-control" id="email2" placeholder="email acompanhante 2" required="">
              <div class="invalid-feedback label-error" style="width: 100%;">
                E-mail acompanhante 2 requirido.
              </div>
            </div>
          </div>
        </div>


        <div class="row" id="acomp3">          
          <div class="col-md-6 mb-3">
            <label for="nomecompleto">Nome Acompanhante 3</label>
            <input type="text" class="form-control" id="acompanhante3" placeholder="" value="" required="">
            <div class="invalid-feedback label-error">
              Nomes acompanhante 3 Requerido.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email">E-mail acompanhante 3</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">@</span>
              </div>
              <input type="email" class="form-control" id="email3" placeholder="email acompanhante 3" required="">
              <div class="invalid-feedback label-error" style="width: 100%;">
                E-mail acompanhante 3 requirido.
              </div>
            </div>
          </div>
        </div>


        <div class="row" id="acomp4">          
          <div class="col-md-6 mb-3">
            <label for="nomecompleto">Nome Acompanhante 4</label>
            <input type="text" class="form-control" id="acompanhante4" placeholder="" value="" required="">
            <div class="invalid-feedback label-error">
              Nomes acompanhante 4 Requerido.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email">E-mail acompanhante 4</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">@</span>
              </div>
              <input type="email" class="form-control" id="email4" placeholder="email acompanhante 4" required="">
              <div class="invalid-feedback label-error" style="width: 100%;">
                E-mail acompanhante 4 requirido.
              </div>
            </div>
          </div>
        </div>


      </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="datanascimento">Data de Nascimento <span class="text-warning">(Opcional)</span></label>
            <input type="text" class="form-control" id="datanascimento" placeholder="" value="">
            
          </div>
          <div class="col-md-6 mb-3">
            <label for="sexo">Sexo</label>
            <div class="d-block my-3">
              <div class="custom-control custom-radio">
                <input value="m" id="masculino" name="sexo"  type="radio" class="custom-control-input" checked="" required="">
                <label class="custom-control-label" for="masculino">Masculino</label>
              </div>
              <div class="custom-control custom-radio">
                <input value="f" id="feminino" name="sexo"  type="radio" class="custom-control-input" required="">
                <label class="custom-control-label" for="feminino">Feminino</label>
              </div>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="address">Enderço</label>
          <input type="text" class="form-control" id="address" placeholder="Rua" required="">
          <div class="invalid-feedback label-error">
            Please enter your shipping address.
          </div>
        </div>

        <div class="mb-3">
          <label for="bairro">Bairro<span class="text-warning">(Optional)</span></label>
          <input type="text" class="form-control" id="bairro" placeholder="Bairro">
        </div>
        <div class="row">
          <div class="col-md-6">
            <label for="cep">CEP</label>
            <input type="text" class="form-control" id="cep" placeholder="" required="">
            <div class="invalid-feedback label-error">
              CEP requerido.
            </div>
          </div>
          <div class="col-md-6">
            <label for="pais">País</label>
            <input type="text" class="form-control" id="pais" placeholder="" required="">
            <div class="invalid-feedback label-error">
              País requerido.
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="uf">Estado</label>
            <select class="custom-select d-block w-100" id="uf" required="">
              <option value="">Selecione...</option>
              <option value="EX">Extrangeiro</option>
              <!-- BEGIN BLOCK_ESTADO -->
              <option value="{UF}">{UF}</option>
              <!-- END BLOCK_ESTADO -->
            </select>
            <div class="invalid-feedback label-error">
             Por favor selecione um estrado.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="cidade">Cidade</label>
            <select class="custom-select d-block w-100" id="cidade" required="">
              <option value="">Selecione...</option>
          </select>
            <div class="invalid-feedback label-error">
              Por favor selecione um país.
            </div>
          </div>        
          
        </div>
      </div>
  </div>
  <div class="row">
    <div class="col-md-12">
    <hr class="mb-4">
    <button class="btn btn-primary btn-lg btn-block" type="submit">Continue to checkout</button>
  </div>
  </div>
</form>
  <footer class="my-5 pt-5 text-muted text-center text-small">
    <p class="mb-1">© 2017-2018 Company Name</p>
    <ul class="list-inline">
      <li class="list-inline-item"><a href="#">Privacy</a></li>
      <li class="list-inline-item"><a href="#">Terms</a></li>
      <li class="list-inline-item"><a href="#">Support</a></li>
    </ul>
  </footer>
</div>

<script>
      // Example starter JavaScript for disabling form submissions if there are invalid fields
      (function() {
        'use strict';

        window.addEventListener('load', function() {
          // Fetch all the forms we want to apply custom Bootstrap validation styles to
          var forms = document.getElementsByClassName('needs-validation');

          // Loop over them and prevent submission
          var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
              if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
              }
              form.classList.add('was-validated');
            }, false);
          });

          document.getElementById("cpf").oninput = checkCpf;
        }, false);
      })();

function blockAcomp(numero,disabled){
  let nome = $("#acompanhante"+numero);
  let email = $("#email"+numero);
  if(disabled){
  nome.attr('disabled',disabled);
  email.attr('disabled',disabled);
  }else{
  nome.removeAttr('disabled');
  email.removeAttr('disabled');
  }
}

      function atualizaTela(){
        if(quantidade == 1){
          $("#boxAcompanhante").hide();
          blockAcomp(1,true);
          blockAcomp(2,true);
          blockAcomp(3,true);
          blockAcomp(4,true);
        }else{
          if(quantidade == 2){
            blockAcomp(1,false);
            blockAcomp(2,true);
            blockAcomp(3,true);
            blockAcomp(4,true);
          }else if(quantidade == 3){
            blockAcomp(1,false);
            blockAcomp(2,false);
            blockAcomp(3,true);
            blockAcomp(4,true);
          }else if(quantidade == 4){
            blockAcomp(1,false);
            blockAcomp(2,false);
            blockAcomp(3,false);
            blockAcomp(4,true);
          }else{
            blockAcomp(1,false);
            blockAcomp(2,false);
            blockAcomp(3,false);
            blockAcomp(4,false);
          }
          $("#boxAcompanhante").show();
        }
        if(haveOptional && $("#opcional").prop("checked")){
          totalGeral = quantidade*(valorPacote+valorPacoteOpcional);
          
        }else{
          totalGeral =quantidade*valorPacote;
        }
        $("#lbl_total").html(cifrao+floatToCurrency((totalGeral)));
        $("#lbl_total_real").html("R$ "+floatToCurrency((totalGeral*cotacoes.USD.ask)));
        $("#lbl_quantidade").html($("#quantidade").val());
      }

      function floatToCurrency(valor){
        return valor.format(2, 3, ".", ",");
      }
      function CurrencyToFloat(valor){
        return parseFloat(valor);
          
      }

      function getCotacoes(){
        $.get("https://economia.awesomeapi.com.br/all/USD-BRL,EUR-BRL,BTC-BRL",
        function(data, status){
          console.log("Data: " + data + "\nStatus: " + status);
          cotacoes = data;
          atualizaTela();
        }
        );
      }
      function checkCpf() {
        
        input = document.getElementById("cpf");
        cpf = input.value.replaceAll("_","").replaceAll("-","").replaceAll(".","")
        
          if (valida_cpf(cpf) || cpf.length === 0) {
            $(".feedback-cpf").html("Cpf requerido.");
            input.setCustomValidity('');            
          } else {
            $(".feedback-cpf").html("Cpf Inválido.");
            input.setCustomValidity('Cpf Inválido.');
           }
        }

      $(document).ready(function(){
           cotacoes = null;
           cifrao = '{GRUPO_MOEDA} ';
           quantidade = {QUANTIDADE};
           valorPacote = {GRUPO_VALOR};
           valorPacoteOpcional = {GRUPO_OPCIONAL_VALOR};
           cupom =0;
           haveOptional = {GRUPO_OPCIONAL};
        $("#bt_mais").click(function(){
          if(quantidade < 5 ){
          quantidade++;
          }
          $("#quantidade").val(quantidade);
          atualizaTela();
        });
        $("#bt_menos").click(function(){
          if(quantidade > 1){
            quantidade--;
          }
          console.log(quantidade);
            $("#quantidade").val(quantidade);
            atualizaTela();
        });

        $("#opcional").click(function(){
          console.log(this.value);
            atualizaTela();
        });

        $("#datanascimento").datepicker({ language: 'pt-BR' });
        $("#cpf").inputmask({
            mask: "999.999.999-99"
        });

        $('#uf').change(function(){
    	    $('#cidade').load('ajax/comboCidadesPorUf.php?idUf='+$('#uf').val()); 
        });

        $('.page-loader-wrapper').fadeOut();
      $(document).ajaxStart(function() {
        setTimeout(function() { $('.page-loader-wrapper').fadeIn(); }, 50);
    }).ajaxStop(function() {
        setTimeout(function() { $('.page-loader-wrapper').fadeOut(); }, 50);
		});

        getCotacoes();
      });
    </script>
