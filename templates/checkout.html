<div class="container">
  <div class="py-5 text-center">
    <img class="d-block mx-auto mb-4" src="{URL_IMAGE_GRUPO}" alt="" height="140" class="shadow-sm">
    <h2>Vendas - Obra de Maria DF</h2>
    <p class="lead">Você está adquirindo um pacote conosco, entre com seus dados e as informações</p>
  </div>
  <form class="needs-validation submit" novalidate="" action="#" id="form" >
  <div class="row">
    <div class="col-md-6 order-md-2 mb-4">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span >Seu Carrinho</span>
        
        <div class="btn-group" role="group" aria-label="Basic example">
          <button type="button" class="btn btn-danger" id="bt_menos">-</button>
          <button type="button" class="btn btn-secondary" id="lbl_quantidade">{QUANTIDADE}</button>
          <button type="button" class="btn btn-primary" id="bt_mais">+</button>
        </div>
        
      </h4>
      <ul class="list-group mb-3">
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0 text-muted" >{GRUPO_NOME}</h6>
            
          </div>
          <span class="text-muted">{GRUPO_VALOR_CURRENCY}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0 text-muted" >Adesão</h6>
            
          </div>
          <span class="text-muted">{GRUPO_VALOR_ADESAO_CURRENCY}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0 text-muted" >Taxa de Embarque</h6>
            
          </div>
          <span class="text-muted">{GRUPO_VALOR_EMBARQUE_CURRENCY}</span>
        </li>
        <!-- BEGIN BLOCK_OPCIONAL -->
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          
          <div>
            <div class="custom-control custom-checkbox">
              <input type="checkbox" value="1" name="opcional" class="custom-control-input" id="opcional" >
              <label class="custom-control-label text-muted" for="opcional">{GRUPO_OPCIONAL_NOME}</label>
            </div>
            
            
          </div>
          <span class="text-muted">{GRUPO_OPCIONAL_VALOR_CURRENCY}</span>
        </li>
        <!-- END BLOCK_OPCIONAL -->        
        <li class="list-group-item d-flex justify-content-between">
          <span class="text-muted">Total ({GRUPO_MOEDA})</span>
          <strong class="text-muted" id="lbl_total">0,00</strong>
        </li>
      </ul>
      <hr class="mb-4">

      <h4 class="mb-3">Formas de Pagamento</h4>
      <div class="d-block my-3">
        <div class="custom-control custom-radio">
          <input value="formaAVista" id="formaAVista" name="forma" type="radio" class="custom-control-input" checked="" required="">
          <label class="custom-control-label" for="formaAVista">A Vista (5% de Desconto) <span class="badge badge-success">Dollar: {COTACAO_CURRENCY}</span></label>
        </div>
        <div class="custom-control custom-radio">
          <input value="formaEntrada" id="formaEntrada" name="forma" type="radio" class="custom-control-input" required="">
          <label class="custom-control-label" for="formaEntrada">Entrada + Parcelado no Cartão em até 12X <span class="badge badge-success">Dollar: {COTACAO_ENTRADA_CURRENCY}</span></label>
        </div>
        <div class="custom-control custom-radio">
          <input value="formaParcelado" id="formaParcelado" name="forma" type="radio" class="custom-control-input" required="">
          <label class="custom-control-label" for="formaParcelado">Parcelado no cheque em {PARCELAMAXIMA} vezes <span class="badge badge-success">Dollar: {COTACAO_PARCELADO_CURRENCY}</span></label>
        </div>
      </div>
      
      <hr class="mb-4">

      <h4 class="mb-3">Tipo de Pagamento</h4>
      <div id="tipoAVista">        
      <div class="d-block my-3">
        <div class="custom-control custom-radio">
          <input value="transferencia" id="transferenciaAVista" name="pagamentoAVista" type="radio" class="custom-control-input" checked="" required="">
          <label class="custom-control-label" for="transferenciaAVista">Transferência Bancária</label>
        </div>
        <div class="custom-control custom-radio">
          <input value="boleto" id="boletoAVista" name="pagamentoAVista" type="radio" class="custom-control-input" required="">
          <label class="custom-control-label" for="boletoAVista">Boleto (GerenciaNet)</label>
        </div>
        <div class="custom-control custom-radio">
          <input value="cheque" id="chequeAVista" name="pagamentoAVista" type="radio" class="custom-control-input" required="">
          <label class="custom-control-label" for="chequeAVista" id="chequeAVistaLabel">Cheque</label>
        </div> 
        
      </div>
    </div>
    
    <div id="tipoEntrada">
      <h5 class="mb-3">Entrada 20%: <span id="valor20" class="badge badge-success"></span></h5>
      <div class="d-block my-3">
        <div class="custom-control custom-radio">
          <input value="transferencia" id="entradatransferenciaEntrada" name="entradaPagamentoEntrada" type="radio" class="custom-control-input" checked="" required="">
          <label class="custom-control-label" for="entradatransferenciaEntrada">Transferência Bancária</label>
        </div>
        <div class="custom-control custom-radio">
          <input value="boleto" id="entradaBoletoEntrada" name="entradaPagamentoEntrada" type="radio" class="custom-control-input" required="">
          <label class="custom-control-label" for="entradaBoletoEntrada">Boleto (GerenciaNet)</label>
        </div>
        <div class="custom-control custom-radio">
          <input value="cheque" id="entradachequeEntrada" name="entradaPagamentoEntrada" type="radio" class="custom-control-input" required="">
          <label class="custom-control-label" for="entradachequeEntrada" id="entradachequeEntradaLabel">Cheque</label>
        </div> 
      </div>
      <h5 class="mb-3">Parcelamento: <span id="valor80" class="badge badge-success"></span></h5>
      <div class="custom-control custom-radio">
        <input value="credit_card" id="creditoEntrada" name="pagamentoEntrada" checked type="radio" class="custom-control-input" required="">
        <label class="custom-control-label" for="creditoEntrada" id="creditoEntradaLabel">Cartão de crédito (GerenciaNet até 12 vezes com juros)</label>
      </div>
      <div class="custom-control custom-radio">
        <input value="cheque" id="chequeEntrada" name="pagamentoEntrada" type="radio" class="custom-control-input" checked="" required="">
        <label class="custom-control-label" for="chequeEntrada" id="chequeEntradaLabel">Cheque</label>
      </div>  
    </div>


    <div id="tipoParcelado">
      <h5 class="mb-3">Parcelado em <span id="qtdParcelas" class="badge badge-success"> {PARCELAMAXIMA} vezes</span></h5>
      <div class="d-block my-3">
        <div class="custom-control custom-radio">
          <input value="cheque" id="cheque" name="pagamentoParcelado" type="radio" class="custom-control-input" checked="" required="">
          <label class="custom-control-label" for="cheque" id="chequeParceladoLabel">Cheque</label>
        </div>        
        <!--div class="custom-control custom-radio">
          <input value="3" id="paypal" name="pagamento" type="radio" class="custom-control-input" required="">
          <label class="custom-control-label" for="paypal">Paypal</label>
        </div-->
      </div>
    </div>
      <ul class="list-group m-3">
        <li class="list-group-item d-flex justify-content-between">
          <span class="text-muted">Total Final R$</span>
          <strong class="text-muted" id="lbl_total_real">0,00</strong>
        </li>
      </ul>
    </div>





    <div class="col-md-6 order-md-1">
      <h4 class="mb-3">Meus Dados</h4>
      
        <input type="hidden" name="quantidade" id="quantidade" value="{QUANTIDADE}"/>
        <input type="hidden" name="idGrupo" value="{ID_GRUPO}"/>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="cpf">CPF</label>
            <input  name="cpf" type="text" class="form-control" id="cpf" placeholder="" value="" required="">
            <div class="invalid-feedback label-error feedback-cpf">
              Cpf requerido.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="nomeCompleto">Nome Completo</label>
            <input  name="nomeCompleto" type="text" class="form-control" id="nomeCompleto" placeholder="" value="" required="">
            <div class="invalid-feedback label-error">
              Nome Completo Requerido.
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="email">E-mail</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text">@</span>
            </div>
            <input  name="email" type="email" class="form-control" id="email" placeholder="email" required="">
            <div class="invalid-feedback label-error" style="width: 100%;">
              E-mail requirido.
            </div>
          </div>
        </div>
        <div id="boxAcompanhante">
        <h4 class="mb-3">Acompanhantes</h4>

        <div class="row" id="acomp1">          
          <div class="col-md-6 mb-3">
            <label for="acompanhante1">Nome Acompanhante 1</label>
            <input  name="acompanhante1" type="text" class="form-control" id="acompanhante1" placeholder="" value="" required="">
            <div class="invalid-feedback label-error">
              Nomes acompanhante 1 Requerido.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email1">E-mail acompanhante 1</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">@</span>
              </div>
              <input  name="email1" type="email" class="form-control" id="email1" placeholder="email acompanhante 1" required="">
              <div class="invalid-feedback label-error" style="width: 100%;">
                E-mail acompanhante 1 requirido.
              </div>
            </div>
          </div>
        </div>


        <div class="row" id="acomp2">          
          <div class="col-md-6 mb-3">
            <label for="acompanhante2">Nome Acompanhante 2</label>
            <input type="text" class="form-control" name="acompanhante2" id="acompanhante2" placeholder="" value="" required="">
            <div class="invalid-feedback label-error">
              Nomes acompanhante 2 Requerido.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email2">E-mail acompanhante 2</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">@</span>
              </div>
              <input type="email" class="form-control" name="email2" id="email2" placeholder="email acompanhante 2" required="">
              <div class="invalid-feedback label-error" style="width: 100%;">
                E-mail acompanhante 2 requirido.
              </div>
            </div>
          </div>
        </div>


        <div class="row" id="acomp3">          
          <div class="col-md-6 mb-3">
            <label for="acompanhante3">Nome Acompanhante 3</label>
            <input type="text" class="form-control" name="acompanhante3" id="acompanhante3" placeholder="" value="" required="">
            <div class="invalid-feedback label-error">
              Nomes acompanhante 3 Requerido.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email3">E-mail acompanhante 3</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">@</span>
              </div>
              <input type="email" class="form-control" name="email3" id="email3" placeholder="email acompanhante 3" required="">
              <div class="invalid-feedback label-error" style="width: 100%;">
                E-mail acompanhante 3 requirido.
              </div>
            </div>
          </div>
        </div>


        <div class="row" id="acomp4">          
          <div class="col-md-6 mb-3">
            <label for="acompanhante4">Nome Acompanhante 4</label>
            <input type="text" class="form-control" name="acompanhante4" id="acompanhante4" placeholder="" value="" required="">
            <div class="invalid-feedback label-error">
              Nomes acompanhante 4 Requerido.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email4">E-mail acompanhante 4</label>
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text">@</span>
              </div>
              <input type="email" class="form-control" name="email4" id="email4" placeholder="email acompanhante 4" required="">
              <div class="invalid-feedback label-error" style="width: 100%;">
                E-mail acompanhante 4 requirido.
              </div>
            </div>
          </div>
        </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="datanascimento">Data de Nascimento <span class="text-warning">(Opcional)</span></label>
            <input  type="text" name="datanascimento" class="form-control" id="datanascimento" placeholder="" value="">
            
          </div>
          <div class="col-md-6 mb-3">
            <label for="sexo">Sexo</label>
            <div class="d-block my-3">
              <div class="custom-control custom-radio">
                <input checked value="M" id="masculino" name="sexo"  type="radio" class="custom-control-input" checked="" required="">
                <label class="custom-control-label" for="masculino">Masculino</label>
              </div>
              <div class="custom-control custom-radio">
                <input value="F" id="feminino" name="sexo"  type="radio" class="custom-control-input" required="">
                <label class="custom-control-label" for="feminino">Feminino</label>
              </div>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="address">Enderço</label>
          <input  name="endereco" type="text" class="form-control" id="endereco" placeholder="Rua" required="">
          <div class="invalid-feedback label-error">
            Please enter your shipping address.
          </div>
        </div>

        <div class="mb-3">
          <label for="bairro">Bairro<span class="text-warning">(Optional)</span></label>
          <input  type="text" name="bairro" class="form-control" id="bairro" placeholder="Bairro">
        </div>
        <div class="row">
          <div class="col-md-6">
            <label for="cep">CEP</label>
            <input type="text" name="cep" class="form-control" id="cep" placeholder="" required="">
            <div class="invalid-feedback label-error">
              CEP requerido.
            </div>
          </div>
          <div class="col-md-6">
            <label for="pais">País</label>
            <input  type="text" name="pais" class="form-control" id="pais" placeholder="" required="">
            <div class="invalid-feedback label-error">
              País requerido.
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="uf">Estado</label>
            <select name="uf" class="custom-select d-block w-100" id="uf" required="">
              <option value="">Selecione...</option>
              <option value="EX">Extrangeiro</option>
              <!-- BEGIN BLOCK_ESTADO -->
              <option value="{UF}">{UF}</option>
              <!-- END BLOCK_ESTADO -->
            </select>
            <div class="invalid-feedback label-error">
             Por favor selecione um estrado.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="cidade">Cidade</label>
            <select name="cidade" class="custom-select d-block w-100" id="cidade" required="">
              <option value="">Selecione...</option>
          </select>
            <div class="invalid-feedback label-error">
              Por favor selecione um país.
            </div>
          </div>        
          
        </div>
        <hr class="mb-4">
        <div class="custom-control custom-checkbox">
          <input value="1" checked="checked" type="checkbox" class="custom-control-input" id="mailmarketing" name="mailmarketing">
          <label class="custom-control-label" for="mailmarketing">Receber emails da Obra de Maria DF</label>
        </div>
        <div class="custom-control custom-checkbox">
          <input value="1"  type="checkbox" class="custom-control-input" id="termos" name="termos" required>
          <label class="custom-control-label" for="termos">Li o contrato e aceito os termos</label>
          <div class="invalid-feedback label-error">
            Por favor aceite os termos.
          </div>
        </div>
      </div>

    </div>
    
  <div class="row">
    <div class="col-md-12">
    <hr class="mb-4">
    <button class="btn btn-primary btn-lg btn-block" type="submit" >Finalizar Compra</button>
  </div>
  </div>
</form>
</div>

<script>
      // Example starter JavaScript for disabling form submissions if there are invalid fields
      (function() {
        'use strict';

        window.addEventListener('load', function() {
          // Fetch all the forms we want to apply custom Bootstrap validation styles to
          var forms = document.getElementsByClassName('needs-validation');

          // Loop over them and prevent submission
          var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
              if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
              }else{
                event.preventDefault();
                event.stopPropagation();
                postform();
              }
              form.classList.add('was-validated');
            }, false);
          });

          document.getElementById("cpf").oninput = checkCpf;
        }, false);
      })();

function blockAcomp(numero,disabled){
  let nome = $("#acompanhante"+numero);
  let email = $("#email"+numero);
  if(disabled){
  nome.attr('disabled',disabled);
  email.attr('disabled',disabled);
  }else{
  nome.removeAttr('disabled');
  email.removeAttr('disabled');
  }
}

      function atualizaTela(){
        if(quantidade == 1){
          $("#boxAcompanhante").hide('slow');
          blockAcomp(1,true);
          blockAcomp(2,true);
          blockAcomp(3,true);
          blockAcomp(4,true);
        }else{
          if(quantidade == 2){
            blockAcomp(1,false);
            blockAcomp(2,true);
            blockAcomp(3,true);
            blockAcomp(4,true);
          }else if(quantidade == 3){
            blockAcomp(1,false);
            blockAcomp(2,false);
            blockAcomp(3,true);
            blockAcomp(4,true);
          }else if(quantidade == 4){
            blockAcomp(1,false);
            blockAcomp(2,false);
            blockAcomp(3,false);
            blockAcomp(4,true);
          }else{
            blockAcomp(1,false);
            blockAcomp(2,false);
            blockAcomp(3,false);
            blockAcomp(4,false);
          }
          $("#boxAcompanhante").show('slow');
        }
        if(haveOptional && $("#opcional").prop("checked")){
          totalGeral = quantidade*(valorPacote+valorPacoteOpcional);
          
        }else{
          totalGeral =quantidade*valorPacote;
        }
        $("#lbl_total").html(cifrao+floatToCurrency((totalGeral)));

        let dollar =cotacao;


        if($("#formaAVista").prop("checked")){
          dollar = cotacao;
          totalGeral = totalGeral-(totalGeral*0.05);
          $("#tipoAVista").show('slow');
          $("#tipoParcelado").hide();
          $("#tipoEntrada").hide();
        }
        if($("#formaEntrada").prop("checked")){
          dollar = cotacaoEntrada;
          if(idmoeda != 2){            
            $("#valor20").html("R$ "+floatToCurrency(totalGeral*dollar*0.2)); 
            $("#valor80").html("R$ "+floatToCurrency(totalGeral*dollar*0.8));
            $("#chequeEntradaLabel").html("Cheque "+parcelamaxima+" vezes de R$ "+floatToCurrency((totalGeral*dollar*0.8)/parcelamaxima));
            }else{
              $("#valor20").html("R$ "+totalGeral*0.2);
              $("#valor80").html("R$ "+floatToCurrency(totalGeral*0.8));
              $("#chequeEntradaLabel").html("Cheque "+parcelamaxima+" vezes de R$ "+floatToCurrency((totalGeral*0.8)/parcelamaxima));
            }
          
          $("#tipoAVista").hide();
          $("#tipoParcelado").hide();
          $("#tipoEntrada").show('slow');
        }
        if($("#formaParcelado").prop("checked")){
          dollar = cotacaoParcelado;
          if(idmoeda != 2){  
          $("#chequeParceladoLabel").html("Cheque "+parcelamaxima+" vezes de R$ "+floatToCurrency((totalGeral*dollar)/parcelamaxima));
          }else{
            $("#chequeParceladoLabel").html("Cheque "+parcelamaxima+" vezes de R$ "+floatToCurrency((totalGeral)/parcelamaxima));  
          }
          $("#tipoAVista").hide();
          $("#tipoParcelado").show('slow');
          $("#tipoEntrada").hide();
        }
        
        if(idmoeda != 2){
        $("#lbl_total_real").html("R$ "+floatToCurrency((totalGeral*dollar)));
        }else{
          $("#lbl_total_real").html("R$ "+floatToCurrency((totalGeral)));
        }
        $("#lbl_quantidade").html($("#quantidade").val());
      }

      function floatToCurrency(valor){
        return valor.format(2, 3, ".", ",");
      }
      function CurrencyToFloat(valor){
        return parseFloat(valor);
          
      }

      function getCotacoes(){
        
        $.get("https://economia.awesomeapi.com.br/all/USD-BRL,EUR-BRL,BTC-BRL",
        function(data, status){
          
          cotacoes = data;
          atualizaTela();
        }
        );
      }


      function preencheForm(cliente){
        console.log(cliente.nomeCompleto);
        $("#nomeCompleto").val(cliente.nomeCompleto);
        $("#email").val(cliente.email);
        $("#datanascimento").val(cliente.dataNascimento);
        if(cliente.sexo == 'M'){
          $("#masculino").prop("checked",true);
        }else{
          $("#feminino").prop("checked",true);
        }
        $("#endereco").val(cliente.endereco);
        $("#bairro").val(cliente.bairro);
        $("#cep").val(cliente.cep);
        $("#pais").val(cliente.paisEndereco);
        $("#uf").val(cliente.estadoEndereco);
        if(cliente.enviaCorrespondencia == 1){
          $("#mailmarketing").prop("checked",true); 
        }else{
          $("#mailmarketing").prop("checked",false);
        }
        $('#cidade').load('ajax/comboCidadesPorUf.php?selected='+cliente.cidadeEndereco+'&idUf='+$('#uf').val());
      }
      function checkCpf() {
        
        input = document.getElementById("cpf");
        cpf = input.value.replaceAll("_","").replaceAll("-","").replaceAll(".","")
        
          if (valida_cpf(cpf) || cpf.length === 0) {
            $(".feedback-cpf").html("Cpf requerido.");
            input.setCustomValidity('');            
          } else {
            $(".feedback-cpf").html("Cpf Inválido.");
            input.setCustomValidity('Cpf Inválido.');
           }
        }


        function postform(){
            let form = $("#form").serialize();
            
            //funcao de sucesso
            var funcSuccess = function(data) {
            if(data.code == 200){
              console.log(data);
              window.location.href="bilhete.php?charge_id="+data.data.charge_id;
            
            }else{
              showMessage("Erro", data.data.mensagem);
              //alert("Erro encontrado\n"+data.data.mensagem);
            }
            }
            //funcao de erro
            var funcDefaultError = function(erro) {
              showMessage();
            //console.log(erro.status + '-' + erro.responseText);
            }
            postJson('ajax/shopping/checkout.php',form,funcSuccess,funcDefaultError);
           
        }

        function postJson(url, data, sucesso, erro) {
            $.ajax({
                    type: "POST",
                    url: url,
                    dataType: "json",
                    data: data
                })
                .done(sucesso)
                .fail(erro);
        }

      $(document).ready(function(){
           cotacao = {COTACAO};
           cotacaoEntrada = {COTACAO_ENTRADA};
           cotacaoParcelado = {COTACAO_PARCELADO};
           cifrao = '{GRUPO_MOEDA} ';
           idmoeda = {GRUPO_IDMOEDA};
           quantidade = {QUANTIDADE};
           valorPacote = {GRUPO_VALOR};
           valorPacoteOpcional = {GRUPO_OPCIONAL_VALOR};
           cupom =0;
           haveOptional = {GRUPO_OPCIONAL};
           parcelamaxima = {PARCELAMAXIMA};
           
        $("#bt_mais").click(function(){
          if(quantidade < 5 ){
          quantidade++;
          }
          $("#quantidade").val(quantidade);
          atualizaTela();
        });
        $("#bt_menos").click(function(){
          if(quantidade > 1){
            quantidade--;
          }
          
            $("#quantidade").val(quantidade);
            atualizaTela();
        });

        $("#opcional").click(function(){
          
            atualizaTela();
        });
        $("#formaEntrada,#formaAVista,#formaParcelado").click(function()
        {
          atualizaTela();
        });

        $("#datanascimento").datepicker({ language: 'pt-BR' });
        $("#cpf").inputmask({
            mask: "999.999.999-99"
        });

        $("#cep").inputmask({
            mask: "99.999-999"
        });

        $('#uf').change(function(){
    	    $('#cidade').load('ajax/comboCidadesPorUf.php?idUf='+$('#uf').val()); 
        });
        $("#cpf").change(function(){

          buscaPeloCpf();      
        });
       
       

        atualizaTela();

      });

      function buscaPeloCpf(){
        var funcSuccess = function(data) {
            console.log(data.code);
              if(data.code == 200){
                preencheForm(data.data);
              }
            }
            //funcao de erro
            var funcDefaultError = function(erro) {
              
            //console.log(erro.status + '-' + erro.responseText);
            }
            postJson('ajax/shopping/clienteByCpf.php',{"cpf":$("#cpf").val()},funcSuccess,funcDefaultError);

      }
    </script>